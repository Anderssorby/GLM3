---
title: "Logistic regression and Poisson regression"
author: "Anders Christiansen SÃ¸rby, Edvard Hove, Angela Maiken Johnsen"
date: "October 4, 2018"
output:
  pdf_document: default
  html_document:
    df_print: paged
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
#install.packages("ggplot2")
#install.packages("GGally")
#install.packages("rlist")
#install.packages("lme4")
library(ggplot2)
library(rlist)
library(reshape2)
library(plyr)
library(GGally)
```


# a)
```{r}
dataset <- read.table("https://www.math.ntnu.no/emner/TMA4315/2018h/jsp2.txt", header = TRUE)
ggpairs(data = dataset, mapping = aes(col = gender), columns = c("social", "raven", "math"), legend = 1)
```
From the plot it can be seen from the top and bottom right panel that girls have higher average maths scores than boys. This is because the mean of the blue box plots in the top right panel (corresponding to the girls' maths scores) are higher than that of the boys' (red boxes). However, as 0 is included in all the box plots, the difference is not too big. The same conclusion can be drawn from the bottom right panel; here the distribution of the girls' maths scores have a peak slightly more to the right than that of the boys.  

Fitting a linear model with math as response and raven and gender as covariates:
```{r}
model = lm(math ~ raven + gender, data = dataset)
model
```
The model for the $k$th student is thus

$$
Y_k={\bf x}_k \pmb{\beta} + \varepsilon_k,
$$
where the $\varepsilon_k$s are independent, have mean 0 and variance $\sigma^2$. Here the $Y_k$ is the response, $\bf x_k$ are the covariates, $\varepsilon_k$ are the residuals and $\pmb{\beta}$ the parameter estimates.
Here the parameter estimates are $\beta_0 = -1.313$,  $\beta_{\mathrm{raven}} = 0.1965$ and $\beta_{\mathrm{gendergirl}} = 2.538$. This means that being a girl has a positive impact on the maths test score, and a positive raven test score also gives a positive impact on the maths test score. Here $\beta_0$, i. e. the intercept, corresponds to the parameter estimate for a boy. 
By looking at the $p$ values of the parameter estimates, all of them are highly significant. 
In this model we are investigating if there is a linear relationship between maths test score and raven test score and gender, and we are assuming that the maths test score does not depend on social status and which school the student comes from.

# b)
Now a random intercept model with math as response and raven and gender as covariates as before, in addition to school as a random intercept. This can be written mathematically as

$$
{\bf Y}_{i} = {\bf X}_i\beta + {\bf 1} \gamma_{0i} + \varepsilon_{i}
$$
As before $\bf Y_i$ is the response, $\bf X$ the covariates, $\beta$ the fixed effects (and $\beta_0$ the fixed population intercept), $\gamma_{0i}$ the deviation (for members of cluster i) from the population intercept $\beta_0$.
```{r}
library(lme4)
fitRI1 <- lmer(math ~ raven + gender + (1 | school), data = dataset)
summary(fitRI1)
```
# c)
# d)
# e)

